<style>
    #email, #key {
        border: 1px solid silver;
        font-size: 1em;
        line-height: 2em;
        padding-left: 5px;
    }
    #article-container > h1 {
        display: none;
    }
    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
		margin-left: auto;
        margin-right: auto;
		margin-bottom: 15em;
        margin-top: 15em;

    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div id="article-container">
    This article is exclusively for <b>PRO</b> subscribers. Please fill in your PRO subscription details:
    <p>
        <p><span style="display:inline-block;width:50px">Email:</span> <input type="email" id="email" name="email" placeholder="john@gmail.com" required></p>
        <p><span style="display:inline-block;width:50px">Key:</span> <input type="text" id="key" name="key" placeholder="XXXXX-XXXXXX-XXXXXX" required></p>
        <button onclick="fetchProContent()" >Show article</button> or buy a <a href="https://devsoap.com/store?product={{page.product}}" >PRO subscription</a>
    </p>
</div>
    
<script>
    function fetchProContent() {
        var product = "{{collection.product}}";
        var article = "{{page.article}}";
        var email = document.getElementById("email").value;
        var key = document.getElementById("key").value;
        if (email != undefined && email.trim() != '' && key != undefined && key.trim() != '') {
            document.getElementById("article-container").innerHTML = "<div class='loader'></div>";
            fetch(`https://fns.devsoap.com/t/license-server/fetch?email=${email}&product=${product}&article=${article}&key=${key}`)
                .then(function(response) {
                    if(response.ok) {
                        return response.text();
                    }
                    throw new Error('Failed fetching article.');
                })
                .then(function(html){
                        window.localStorage.setItem("devsoap.{{collection.product}}.email", email);
                        window.localStorage.setItem("devsoap.{{collection.product}}.key", key);
                        window.localStorage.setItem("devsoap.{{collection.product}}.article.{{page.article}}", html);
                        document.getElementById("article-container").innerHTML = html;
                        document.getElementById("sponsorship").style.display = 'none';
                });
        }
    } 
    
    var storedArticle = window.localStorage.getItem("devsoap.{{collection.product}}.article.{{page.article}}");
    if(storedArticle != undefined) {
        document.getElementById("article-container").innerHTML = storedArticle;
    } else {
        console.log("Article not found in local storage.");
        var storedEmail = window.localStorage.getItem("devsoap.{{collection.product}}.email");
        var storedKey = window.localStorage.getItem("devsoap.{{collection.product}}.key");
        if (storedEmail != undefined && storedKey != undefined) {
            document.getElementById("email").value = storedEmail;
            document.getElementById("key").value = storedKey;
            fetchProContent();
        } else {
            console.log("Credentials not found in local storage. Showing login dialog.");
        }
    }
</script>
